# 1、查看集群设置

```shell
get /_cluster/settings
>>
{
    "persistent": {
        "cluster": {
            "routing": {
                "allocation": {
                    "cluster_concurrent_rebalance": "20"
                }
            }
        },
        "indices": {
            "recovery": {
                "max_bytes_per_sec": "300mb"
            }
        }
    },
    "transient": {
        "cluster": {
            "routing": {
                "allocation": {
                    "enable": "none"
                }
            }
        }
    }
}

```

# 2、集群停分配

```shell
put /_cluster/settings
{
    "transient":{
        "cluster.routing.allocation.enable": "none"
    }
}
#transient： 表示临时设置，重启服务之后此设置失效
#persistent： 表示永久设置，重启服务之后仍然有效
```

# 3、集群开分配

```javascript
put /_cluster/settings
{
    "transient":{
        "cluster.routing.allocation.enable": "all"
    }
}
//关分配
//"cluster.routing.allocation.enable": null
```

# 4、查看健康信息

```shell
get /_cluster/health 
>>response:
{
    "cluster_name": "steppecluster4xx",        #集群名称
    "status": "green",                         #集群状态，有green,yellow,red 三种情况
    "timed_out": false,                        #是否超时，false表示未超时
    "number_of_nodes": 3,                      #当前集群的节点数量
    "number_of_data_nodes": 3,                 #当前集群的数据节点的数量
    "active_primary_shards": 23,               #活动的主分片数量
    "active_shards": 46,                       #总共的分片数量（包括主分片和副本）
    "relocating_shards": 0,                    #正在迁移的分片数量，当它不为0时，表明集群正在迁移分片，
    #迁移分片针对的是已经存在的分片。如果是不存在的分片，创建的过程是初始化分片，
    #此时initializing_shards不为0，与reloacting_shards无关，   
    "initializing_shards": 0,                  #正在初始化的分片数量
    "unassigned_shards": 0,                    #未分配的分片数量，未分配的分片可以理解为，应该存在，但是还没有创建的分片。
        #比如A是主分片，A'是副本分片，但是此时A'副本还有创建或初始化，那么A’此时就是未分配的分片。        
    "delayed_unassigned_shards": 0,            #延迟未分配的分片数量
    "number_of_pending_tasks": 0,              #等待执行的任务数量
    "number_of_in_flight_fetch": 0,            #正在进行的数据获取请求数量
    "task_max_waiting_in_queue_millis": 0,    #队列中等待的任务最长等待时间（毫秒），0表示没有任务在队列中等待。
    "active_shards_percent_as_number": 100    #活动分片百分比（作为数字），这里是 100，表示所有分片都是活动的。
}

```

# 5、查看节点数量

```shell
get /_cat/nodes  
{}
#
10.129.8.16   7 99 11 1.58 1.76 1.67 mdi - node-3
10.129.8.113 10 55  0 0.22 0.37 0.43 mdi * node-2
```

# 6、参数设置

## 6.1 设置流量带宽

```javascript
PUT /_cluster/settings
{
  "transient": {
    "indices.recovery.max_bytes_per_sec": "10MB"
  }
}
curl -XPUT  localhost:9297/_cluster/settings  -d '{
  "transient": {
    "indices.recovery.max_bytes_per_sec": "500MB"
  }
}'
```

# 7、分片移动

```javascript
POST /_cluster/reroute
{
  "commands" : [
    {
      "move" : {
        "index" : "shop",
        "shard" : 0,
        "from_node" : "node-1", 
        "to_node" : "node-2"
      }
    }
  ]
}
//"allow_primary": true    是否允许移动主分片。TRUE： 允许。
```

# 8、分片并发数设置

## 8.1  relocating_shards 最大值	

```javascript
PUT /_cluster/settings
{
  "transient": {
    "cluster.routing.allocation.cluster_concurrent_rebalance":51
  }
}
```

## 8.2  initializing_shards  最大值

```javascript
PUT /_cluster/settings
{
  "transient": {
    "cluster.routing.allocation.node_concurrent_incoming_recoveries":51,
    "cluster.routing.allocation.node_concurrent_recoveries":51
  }
}
//最大值取incoming_recoveries和recoveries的总和，也就是102 的并发
```