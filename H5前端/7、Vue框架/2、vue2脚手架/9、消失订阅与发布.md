## 消息订阅与发布（pubsub）

1. 一种组件间通信的方式，适用于任意组件间通信。

1. 使用步骤：

1. 安装pubsub：npm i pubsub-js

1. 引入: import pubsub from 'pubsub-js'

1. 接收数据：A组件想接收数据，则在A组件中订阅消息，订阅的回调留在A组件自身。

```javascript
methods(){
  demo(data){......}
}
......
mounted() {
  this.pid = pubsub.subscribe('xxx',this.demo) //订阅消息
}
```

1. 提供数据：pubsub.publish('xxx',数据)

1. 最好在beforeDestroy钩子中，用PubSub.unsubscribe(pid)去取消订阅。

# Student.vue

```javascript
<template>
 <div class="student">
  <h2>学生姓名：{{name}}</h2>
  <h2>学生性别：{{sex}}</h2>
  <button @click="sendStudentName">把学生名给School组件</button>
 </div>
</template>
<script>
 import pubsub from 'pubsub-js'
 export default {
  name:'Student',
  data() {
   return {
    name:'张三',
    sex:'男',
   }
  },
  mounted() {
   // console.log('Student',this.x)
  },
  methods: {
   sendStudentName(){
    // this.$bus.$emit('hello',this.name)
    pubsub.publish('hello',666)
   }
  },
 }
</script>
<style lang="less" scoped>
 .student{
  background-color: pink;
  padding: 5px;
  margin-top: 30px;
 }
</style>
```

# Student.vue

```javascript
<template>
 <div class="student">
  <h2>学生姓名：{{name}}</h2>
  <h2>学生性别：{{sex}}</h2>
  <button @click="sendStudentName">把学生名给School组件</button>
 </div>
</template>
<script>
 import pubsub from 'pubsub-js'
 export default {
  name:'Student',
  data() {
   return {
    name:'张三',
    sex:'男',
   }
  },
  mounted() {
   // console.log('Student',this.x)
  },
  methods: {
   sendStudentName(){
    // this.$bus.$emit('hello',this.name)
    pubsub.publish('hello',666)
   }
  },
 }
</script>
<style lang="less" scoped>
 .student{
  background-color: pink;
  padding: 5px;
  margin-top: 30px;
 }
</style>
```