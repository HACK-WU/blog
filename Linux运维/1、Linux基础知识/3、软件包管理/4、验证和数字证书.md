**1、验证(Verify)**

验证 （Verify） 的功能主要在于提供系统管理员一个有用的管理机制，作用的方式是'使用

```javascript
[[root@localhost ~]# rpm -Va
[root@localhost ~]# rpm -V  已安裝的軟體名稱
[root@localhost ~]# rpm -Vp 某個 RPM 檔案的檔名
[root@localhost ~]# rpm -Vf 在系統上面的某個檔案
选项和参数:
    -V:(verify,验证)后面跟软件名，若这个软件所包含的文件被修改过,就会显示。
    -Va:(verify all,验证所有)列出目前系统上，所有可能被修改过的文件
    -Vl:(verify list,验证 清单)，后面跟软件名，列出这个软件可能被修改过的文件
    -vf:(verify file,验证文件)，显示某个文件是否被修改过。
```

**范例一：验证logrotate这个软甲是否被修改过**

```javascript
[root@server1 ~]# rpm -V logrotate 
#没有任何信息，证明没有被修改过。
```

修改logrotate的配置文件,然后再次验证

```javascript
[root@server1 ~]# vim /etc/logrotate.conf
[root@server1 ~]# rpm -V logrotate 
S.5....T.  c /etc/logrotate.conf
#有信息显示，证明确实被修改过了
```

**范例二：查询/etc/logrotate.conf是否被修改过**

```javascript
[root@server1 ~]# rpm -Vf /etc/logrotate.conf 
S.5....T.  c /etc/logrotate.conf
#刚才在范例一的时候就已经修改了，所以这里显示正确
```

 

```javascript
[root@server1 ~]# rpm -Vl logrotate 
S.5....T.  c /etc/logrotate.conf
```

验证内容 文件类型 文件名


出现了提示信息，我们来解释下最前面共有 8 个信息内容，是表示验证内容的。文件名前面的 c


是表示这是个配置文件（configuration）。最后是文件名。那么验证内容中的 8 个信息的具体内容


如下：


- S :(file Size differs） 文件的容量大小是否被改变

- M :(Mode differs 文件的类型或文件属性（rwx） 是否被改变？ 如是否可执行等参数已被改变

- 5 :(MD5 sum differs） MD5 这一种指纹码的内容已经不同

- D :(Device major/minor number mis-match） 装置的主/次代码已经改变

- L :(readLink（2） path mis-match） Link 路径已被改变

- U :(User ownership differs） 文件的所属人已被改变

- G :(Group ownership differs） 文件的所属群组已被改变

- T :(mTime differs） 文件的建立时间已被改变

- P :(caPabilities differ） 功能已经被改变


apache 配置文件的文件类型是 c，那么还有哪些文件类型呢？


-  c 配置文件（config file）


-  d 普通文档（documentation）


-  g “鬼”文件（ghost file），很少见，就是该文件不应该被这个 RPM 包包


含


-  l 授权文件（license file）


-  r 描述文件（read me）[root@localhost ~]# rpm –Vf 系统文件名


选项：


-Vf 校验某个系统文件是否被修改

**补充：数据库从建，如果/var/lib/rpm中的数据库发生损坏，可以使用**

**rpm --rebuliddb 命令，即可从新建立数据库**

```javascript
[root@server1 ~]# rpm --rebuilddb 
```

# **2.数字证书**

刚刚的校验方法只能对已经安装的 RPM 包中的文件进行校验，但是如果 RPM 包本身就被动过手脚，


那么校验就不能解决问题了。我们就必须使用数字证书验证了。


数字证书有如下特点：


-  首先必须找到原厂的公钥文件，然后进行安装


-  再安装 RPM 包是，会去提取 RPM 包中的证书信息，然后和本机安装的原厂证书进行验证


-  如果验证通过，则允许安装；如果验证不通过，则不允许安装并警告


## **1）数字证书位置
**

那么数字证书在哪里呢？其实在 CentOS 6.3 的第一张光盘中就有，当然它默认也会放在系统中。


```javascript
[root@localhost ~]# ll /mnt/cdrom/RPM-GPG-KEY-CentOS-6
-r--r--r-- 2 root root 1706 7 月 2 04:21 /mnt/cdrom/RPM-GPG-KEY-CentOS-6
#光盘中的数字证书位置
[root@localhost ~]# ll /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6
-rw-r--r--. 1 root root 1706 6 月 26 17:29 /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6
#系统中的数字证书位置
```

## **2）数字证书导入
**

```javascript
[root@localhost ~]# rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6
选项：
--import 导入数字证书
我们如何查询系统中安装好的数字证书呢？命令如下：
[root@localhost ~]# rpm -qa | grep gpg-pubkey
gpg-pubkey-c105b9de-4e0fd3a3
```