# **一用户相关文件**

## **1	/etc/passwd 		用户信息文件**

```javascript
root:x:0:0:root:/root:/bin/bash 
  1  2 3 4  5      6     7
```

- 第一列：用户名；

- 第二例：密码位，只是用于标记此用户有密码；无其他作用；

- 第三例：用户ID：

- 0    uid=0; 如果用户的uid=0,就表明这个用户是超级管理员。所以只需要将一个用户的uid改为0，那么这个用			户就变成了超级管理员用户；

- 1-499	系统用户（伪用户）UID。这些用户是系统登录或运行时系统自动使用的用户，是不能用于人工登录的。

- 500-60000	普通用户UID；（因为版本的不同的，可能会有所变化centiOS7 是1000

- ）；

- **用户登录成功后，系统是依靠用户的UID去判断，用户到底是谁，如果将user1的uid改成0（root的uid)，那么系统直接认为user1就是root；**

- 第四列：组ID    GID 添加用户时，如果用户不能指明用户的初始组，那么会建立和用户名相同的组；

- 第五列：	用户说明；

- 第六列：	用户家目录；

- 第七列：	登录shell  ，其实就是用户的权限，如果是普通用户**，一般都是 /bin/bash;**

- **如果是 /sbin/nologin,表示为系统用户（伪用户），不能用于登录shell;**

- **系统用户，是给系统用于启动某个服务使用的，如果删除了这个用户，那么就会导致某个服务无法启动。**

- **可以将这个看做是用户登录权限，如果将****/bin/bash****改为****/sbin/nologin****,那么相应的用户就无法登录系统**

```javascript
 [root@localhost ~]# vim /etc/passwd   //打开用户文件
 
 root:x:0:0:root:/root:/bin/bash           //超级用户
 
  2 bin:x:1:1:bin:/bin:/sbin/nologin
  3 daemon:x:2:2:daemon:/sbin:/sbin/nologin
  4 adm:x:3:4:adm:/var/adm:/sbin/nologin
  5 lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
  6 sync:x:5:0:sync:/sbin:/bin/sync
  7 shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
  8 halt:x:7:0:halt:/sbin:/sbin/halt
  9 mail:x:8:12:mail:/var/spool/mail:/sbin/nologin
 10 operator:x:11:0:operator:/root:/sbin/nologin
 11 games:x:12:100:games:/usr/games:/sbin/nologin
 12 ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin
 13 nobody:x:99:99:Nobody:/:/sbin/nologin
 14 systemd-network:x:192:192:systemd Network Management:/:/sbin/nologin
 15 dbus:x:81:81:System message bus:/:/sbin/nologin
 16 polkitd:x:999:998:User for polkitd:/:/sbin/nologin
 17 sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin
 18 postfix:x:89:89::/var/spool/postfix:/sbin/nologin 
 19 chrony:x:998:996::/var/lib/chrony:/sbin/nologin
```

## **2.	/etc/shadow        影子文件**

```javascript
[root@localhost ~]# vi /etc/shadow
root:$6$iDT5XhSBKuIbtGWa$BxjZFvJmEWj0U.TyT6K0gTWqpNn3VRDwoWgKXHpB8ziFycGSSazTU/ZkJOTL/toTkU0JK/S.pOSLtKg31t7EV/::0:99999:7:::
bin:*:18353:0:99999:7:::
daemon:*:18353:0:99999:7:::
adm:*:18353:0:99999:7:::
lp:*:18353:0:99999:7:::
sync:*:18353:0:99999:7:::
shutdown:*:18353:0:99999:7:::
halt:*:18353:0:99999:7:::
mail:*:18353:0:99999:7:::
operator:*:18353:0:99999:7:::
games:*:18353:0:99999:7:::
ftp:*:18353:0:99999:7:::
nobody:*:18353:0:99999:7:::
systemd-network:!!:18826::::::
dbus:!!:18826::::::
polkitd:!!:18826::::::
sshd:!!:18826::::::
postfix:!!:18826::::::
chrony:!!:18826::::::
```

**两个文件分开写的原因**

**-、etc/password的权限为644:普通用户也可以读取，但这样的话，普通用户也可以看见root用户一起其他用户的密码，非常的不安全，所以将密码单独保存在 /etc/shadow文件中，并设置权限为000，这样，里面的内容只有root用户可以查看。**

```javascript
[root@server1 ~]# ll /etc/passwd
-rw-r--r--. 1 root root 932 1月  13 08:12 /etc/passwd
```

**-/etc/shadow的权限：000**

```javascript
[root@server1 ~]# ll /etc/shadow
----------. 1 root root 736 1月  17 07:43 /etc/shadow
```

- 第一列：	用户名；

- 第二例：	加密密码；

- **可以在密码前认为加上“！”以至于密码失效，达到让用户暂时无法登录的目的；**

- 伪用户的加密密码是“！！”或者“*”代表没有秘密，不能登录。

- 如果新用户没有设置密码，也是显示"!!"; 

- 第三例:	密码最近更改的时间，1970年1月1日作为标准时间； 

如果将这一列改为0，表示从未更改过密码，不合理，下次登录时，会被强制要求改密码。

- 时间戳转日期

```javascript
[root@localhost ~]# date -d "1970-01-01 15775 days"
2013年 03月 11日 星期一 00:00:00 CST
```

- 日期转时间戳

```javascript
[root@localhost ~]# echo $(($(date --date="2021/07/21" +%s)/86400+1))
18829
```

- 第四例：	两次密码修改所允许的间隔时间（和第三字段相比）；

- 第五例：	密码有效期（和第三字段相比）；

- 第六列：	密码修改到期前的警告天数（和第五字段相比);

- 第七列：	密码过期后的有效天数（和第五字段相比，如果值为**-1**，则密码依然有效，如果为0则当天失效），**不写默认值为-1；**

- 第八列：	密码失效时间（时间戳表示）；

- **无论改不改密码，都会失效，也就是相当于用户失效时间。**

- 第九列：	保留；

**获取当前时间的时间戳**

```javascript
[root@server1 ~]# date +%s
1642407446
```

**数值计算，要用两个括号：$((2-1))**

```javascript
[root@server1 ~]# echo $((2-1))
1
```

# **3 	/etc/group	组信息文件**

```javascript
root:x:0:
bin:x:1:
daemon:x:2:
sys:x:3:
adm:x:4:
tty:x:5:
disk:x:6:
lp:x:7:
mem:x:8:
kmem:x:9:
wheel:x:10:
cdrom:x:11:
mail:x:12:postfix
man:x:15:   
dialout:x:18: 
floppy:x:19:
games:x:20: 
tape:x:33: 
video:x:39:  
ftp:x:50:     

```

- 第一列：	组名；

- 第二列：	组密码位；

- 第三列：	GID；

- 第四列：	此组中支持其他用户，如果将user1加入这个组，那么这个组就是user1的附加组；

- 初始组：每个用户初始组只能有一个，切必须有初始组，一般都是和用户名相同的组作为初始组；

- 附加组：每个用户可以有多个或者没有附加组；

# **4	/etc/gshadow		组密码文件   组密码保存在这个文件中；**

-如果给用户设定了组管理员，并给该用户组设定了密码，组密码就保存在这个文件当中。

组管理员就可以利用这个密码管理这个用户组了；

```javascript
[root@server1 ~]# vim /etc/gshadow

root:::
bin:::
daemon:::
sys:::
adm:::
tty:::
disk:::
lp:::
mem:::
```

# **5	/home/[用户名]    每添加一个用户，就会在这个目录下增加一个同名目录；**

```javascript
[root@localhost ~]# useradd user1   //添加用户user1
[root@localhost ~]# 
[root@localhost ~]# ls /home/
user1
[root@localhost ~]# ls -a /home/user1 
.  ..  .bash_logout  .bash_profile  .bashrc
[root@localhost ~]# 
```

# **6	/var/spool/mail/[用户名] 	用户邮箱目录；**

# **7	/etc/skel/		用户模板目录；)****(skel，skeletion:骨骼，基本结构）**

-每添加一个用户目录，就会在这个目录下增加以下的这些目录，作为这个用户的基本信息。

-如果在这个目录下，手动添加一个文件，那么之后增加的用于目录下，都会有这个文件。

```javascript
[root@server1 ~]# ls /etc/skel/ -a
.  ..  .bash_logout  .bash_profile  .bashrc
```

- **以/etc/skel下的内容作为模板，在创建新用户时为用户配置相同的文件dd**

# **二 	用户管理命令**

## **1、添加用户**

### ** useradd 命令
**

```javascript
useradd 选项 用户名

选项：

-u 550 指定 UID

-g 组名 指定初始组 不要手工指定

**-G 组名 指定附加组，把用户加入组，使用附加组   ；（常用）**

-c 说明 添加说明

-d 目录 手工指定家目录，目录不需要事先建立(dir,目录)

-s shell /bin/bash.
```

**例题：创建用户**

```javascript
[root@server1 ~]# useradd -u 1005 -c "test user" -d /home/user1 -s /bin/bash  user1
[root@server1 ~]# cat  /etc/passwd
root:x:0:0:root:/root:/bin/bash
。。。。。。。
user1:x:1005:1005:test user:/home/user1:/bin/bash
[root@server1 ~]# 
```

### **为p2用户添加附加组**

```javascript
[root@server1 ~]# useradd p1
[root@server1 ~]# useradd  -G p1 p2
[root@server1 ~]# cat /etc/group	#查看
p1:x:1006:p2
p2:x:1007:
```

### **1.3 useradd 默认值****
**

useradd 添加用户时参考的默认值文件主要有两个，分别是

- **1)/etc/default/useradd**


```javascript
[root@localhost ~]# vi /etc/default/useradd
# useradd defaults file
GROUP=100			    #目前这句话无效
HOME=/home              #这个选项是用户的家目录的默认位置，所以所有的新建用户的家目录默认都在/home/下。
INACTIVE=-1             #这个选项就是密码过期后的宽限天数，也就是/etc/shadow 文件的第七个字段。如果是天数，比

                        #如 10 代表密码过期后 10 天后失效；如果是 0，代表密码过期后立即失效；如果是-1，则代表密码永

                        #远不会失效。这里默认值是-1，所以所有新建立的用户密码都不会失效。
EXPIRE=
SHELL=/bin/bash
SKEL=/etc/skel
CREATE_MAIL_SPOOL=yes
```

挨个解释下：


 GROUP=100


这个选项是建立用户的默认组，也就是说添加每个用户时，用户的初始组就是 GID 为 100 的这个


用户组。目前我们采用的机制私有用户组机制。


 HOME=/home


这个选项是用户的家目录的默认位置，所以所有的新建用户的家目录默认都在/home/下。


 INACTIVE=-1  

这个选项就是密码过期后的宽限天数，也就是/etc/shadow 文件的第七个字段。如果是天数，比


如 10 代表密码过期后 10 天后失效；如果是 0，代表密码过期后立即失效；如果是-1，则代表密码永


远不会失效。这里默认值是-1，所以所有新建立的用户密码都不会失效。


 EXPIRE=


这个选项是密码失效时间，也就是/etc/shadow 文件的第八个字段。也就说用户到达这个日期后


就会直接失效。当然这里也是使用时间戳来表示日期的。默认值是空，所以所有新建用户没有失效时


间，永久有效。


 SHELL=/bin/bash


这个选项是用户的默认 shell 的。/bin/bash 是 Linux 的标志 shell，所以所有新建立的用户默


认都具备 shell 赋予的权限。


 SKEL=/etc/skel


这个选项就是定义用户的模板目录的位置，/etc/skel/目录中的文件都会复制到新建用户的家目


录当中。


 CREATE_MAIL_SPOOL=yes


这个选项定义是否给新建用户建立邮箱，默认是创建，也就是说所有的新建用户系统都会新建一


个邮箱，放在/var/spool/mail/下和用户名相同。

- **2）/etc/login.defs**


```javascript
[root@localhost ~]# vi /etc/login.defs
//#这个文件有些注释，把注释删除掉，文件内容就变成下面这个样子了
MAIL_DIR /var/spool/mail   #这行指定了新建用户的默认邮箱位置。比如 user1 用户的邮箱是就是/var/spool/mail/user1。
PASS_MAX_DAYS 99999        #这行指定的是密码的有效期，也就是/etc/shadow 文件的第五字段。代表多少天之后必须修改密
PASS_MIN_DAYS 0            #这行指定的是两次密码的修改间隔时间，也就是/etc/shadow 文件的第四字段。代表第一次修改

                           #密码之后，几天后才能再次修改密码。默认值是 0。
PASS_MIN_LEN 5             #这行代表密码的最小长度，默认不小于 5 位。但是我们现在用户登录时验证已经被 PAM 模块取代
PASS_WARN_AGE 7            #这行代表密码修改到期前的警告天数，也就是/etc/shadow 文件的第六字段。代表密码到底有效

                           #期前多少天开始进行警告提醒，默认值是 7 天。
UID_MIN 500                #UID最小范围
UID_MAX 60000              #UID最大范围
GID_MIN 500                #GID最小范围
GID_MAX 60000              #GID最大范围
CREATE_HOME yes            #自动创建家目录
UMASK 077                  #家目录的umask值，所以家目录的全系那是777-077=700
USERGROUPS_ENAB yes        #这行指定的是使用命令 userdel 删除用户时，是否删除用户的初始组，默认是删除。
ENCRYPT_METHOD SHA512      #这行指定 Linux 用户的密码使用 SHA512 散列模式加密，这是新的密码加密模式，原先的 Linux

                           #只能用 DES 或 MD5 方式加密
```

我们一行一行解释下文件内容：


 MAIL_DIR /var/spool/mail


这行指定了新建用户的默认邮箱位置。比如 user1 用户的邮箱是就是/var/spool/mail/user1。


 PASS_MAX_DAYS 99999


这行指定的是密码的有效期，也就是/etc/shadow 文件的第五字段。代表多少天之后必须修改密


码，默认值是 99999。


 PASS_MIN_DAYS 0


这行指定的是两次密码的修改间隔时间，也就是/etc/shadow 文件的第四字段。代表第一次修改


密码之后，几天后才能再次修改密码。默认值是 0。


 PASS_MIN_LEN 5


这行代表密码的最小长度，默认不小于 5 位。但是我们现在用户登录时验证已经被 PAM 模块取代，


所以这个选项并不生效。


 PASS_WARN_AGE 7


这行代表密码修改到期前的警告天数，也就是/etc/shadow 文件的第六字段。代表密码到底有效


期前多少天开始进行警告提醒，默认值是 7 天。


 UID_MIN 500


 UID_MAX 60000


这两行代表创建用户时，最小 UID 和最大的 UID 的范围。我们 2.6.x 内核开始，Linux 用户的 UID


最大可以支持 2


32 这么多，但是真正使用时最大范围是 60000。还要注意如果我手工指定了一个用户的


UID 是 550，那么下一个创建的用户的 UID 就会从 551 开始，哪怕 500-549 之间的 UID 没有使用（小


于 500 的 UID 是给伪用户预留的）。


 GID_MIN 500





 GID_MAX 60000


这两行指定了 GID 的最小值和最大值之间的范围。


 CREATE_HOME yes


这行指定建立用户时是否自动建立用户的家目录，默认是建立


 UMASK 077


这行指定的是建立的用户家目录的默认权限，因为 umask 值是 077，所以新建的用户家目录的权


限是 700，umask 的具体作用和修改方法我们可以参考下一章权限设定章节。


 USERGROUPS_ENAB yes


这行指定的是使用命令 userdel 删除用户时，是否删除用户的初始组，默认是删除。


 ENCRYPT_METHOD SHA512


这行指定 Linux 用户的密码使用 SHA512 散列模式加密，这是新的密码加密模式，原先的 Linux


只能用 DES 或 MD5 方式加密

## **2	设定密码**

```javascript
[root@localhost ~]#passwd [选项] 用户名

选项：

-l: 暂时锁定用户。仅 root 用户可用	# lock ,锁
-u: 解锁用户。仅 root 用户可用		#unlock,解锁
-n mindays：指定最短使用期限
-x maxdays：最大使用期限
-w warndays：提前多少天开始警告
-i inactivedays：非活动期限
--stdin：从标准输入接收用户密码
echo "PASSWD" | passwd --stdin username
```

```javascript
[root@localhost ~]# passwd -l user1
锁定用户 user1 的密码 。
passwd: 操作成功
```




```javascript
[root@localhost ~]# passwd  -u user1
解锁用户 user1 的密码。
passwd: 操作成功
```

**--stdin**

```javascript
[root@localhost ~]# echo "123" |passwd --stdin user1
更改用户 user1 的密码 。
passwd：所有的身份验证令牌已经成功更新。
```




```javascript
[root@localhost ~]#passwd

```

#passwd 直接回车代表修改当前用户的密码;

```javascript
[root@localhost ~]# passwd 
更改用户 root 的密码 。
新的 密码：
```

可以通过命令，把密码修改日期归零（shadow 第 3 字段）.这样用户一登陆就要修改密码，例如：

```javascript
[root@localhost ~]# chage -d 0 user1   //第三字段，上一次修改密码的时间，如果为0，认为是异常，首次登录必须修改密码
[root@localhost ~]# 
```

**chage命令：单独修改密码信息：**

```javascript
[root@xwz ~]# chage -m 0 -M 90 -W 7 -I 14 user01
[root@xwz ~]# chage -h
用法：chage [选项] 登录
选项：
 -d, --lastday 最近日期    将最近一次密码设置时间设为“最近日期”
 -E, --expiredate 过期日期   将帐户过期时间设为“过期日期”
 -h, --help          显示此帮助信息并推出
 -I, --inactive INACITVE    过期 INACTIVE 天数后，设定密码为失效状态
 -l, --list          显示帐户年龄信息
 -m, --mindays 最小天数    将两次改变密码之间相距的最小天数设为“最小天数”
 -M, --maxdays 最大天数    将两次改变密码之间相距的最大天数设为“最大天数”
 -R, --root CHROOT_DIR     chroot 到的目录
 -W, --warndays 警告天数    将过期警告天数设为“警告天数”
```

## **3	用户信息修改**

usermod 命令是修改已经添加的用户的信息的，命令如下：

**（usermod：user-modify:用户信息修改)**

```javascript
[root@localhost ~]#usermod [选项] 用户名
选项：
-u UID： 修改用户的 UID
-d 家目录： 修改用户的家目录。家目录必须写绝对路径
-c 用户说明： 修改用户的说明信息，就是/etc/passwd 文件的第五个字段
-g 组名： 修改用户的初始组，就是/etc/passwd 文件的第四个字段
-G 组名： 修改用户的附加组，其实就是把用户加入其他用户组
    	[root@localhost ~]# usermod -G user2  user1  将用户user1添加为user2的附加组
    	[root@localhost ~]# 
    	[root@localhost ~]# vi /etc/group
    	//user2:x:1001:user1
-s shell： 修改用户的登录 Shell。默认是/bin/bash
-e 日期： 修改用户的失效日期，格式为“YYYY-MM-DD”。也就是/etc/shadow
文件的第八个字段
-L： 临时锁定用户（Lock）
-U： 解锁用户（Unlock）
```

有学员突发奇想，那用户可以修改用户名吗？当然可以：





```javascript
[root@localhost ~]# usermod -l 新名 旧名
#改名
```

**但是真不建议改名，这样及其容易把管理员自己搞晕菜，建议删除旧用户，再建立新用户！**

## **4	删除用户**




```javascript
[root@localhost ~]# userdel [-r] 用户名
选项：
-r： 在删除用户的同时删除用户的家目录 //不加则无法删除家目录
```

## **5	切换用户身份**

```javascript
su 命令可以切换成不同的用户身份，命令格式如下：
[root@localhost ~]# su [选项] 用户名
选项：
-： 选项只使用“-”代表连带用户的环境变量一起切换
-c 命令： 仅执行一次命令，而不切换用户身份
“-”不能省略，它代表切换用户身份时，用户的环境变量也要切换成新用户的环境变量。
[root@localhost ~]# su - user1
最后一次失败的登录：四 7月 22 09:20:41 CST 2021从 192.168.171.72ssh:notty 上
最有一次成功登录后有 3 次失败的登录尝试。
```

# **三	组管理命令**

## **1	添加用户组 groupadd **

```javascript
[root@localhost ~]# groupadd [选项] 组名
选项：
-g GID： 指定组 ID
```

## **2	删除用户组：groupdel **

```javascript
[root@localhost ~]#groupdel testgrp
#删除 testgrp 组
```

## **3	把用户添加到组或从中删除：gpasswd;**

其实 gpasswd 命令是用来

管理员功能很少使用，而且完全可以被 sudo 命令取代，所以 gpasswd 命令现在主要用于把用户添加


进组或从组中删除。命令格式如下：


```javascript
[root@localhost ~]# gpasswd [选项] 组名
选项：
-a 用户名： 把用户加入组		#add,加入
-d 用户名： 把用户从组中删除	#del,删除
```

举个例子：


```javascript
[root@localhost ~]# groupadd grouptest
#添加组 grouptest
[root@localhost ~]# gpasswd -a user1 grouptest
Adding user user1 to group grouptest
#把用户 user1 加入 grouptest 组
[root@localhost ~]# grep "user1" /etc/group
user1:x:501:
grouptest:x:505:user1
#查看一下，user1 用户已经作为附加用户加入 grouptest 组
[root@localhost ~]# gpasswd -d user1 grouptest
Removing user user1 from group grouptest
#把用户 user1 从组中删除
[root@localhost ~]# grep "grouptest" /etc/group
grouptest:x:505:
```

#组中没有 user1 用户了


大家注意，也可以使用 usermod 命令把用户加入某个组，不过 usermod 命令的操作对象是用户，


命令是“usermod -G grouptest user1”，把用户名作为参数放在最后；而 gpasswd 命令的操作对象


是组，命令是“gpasswd -a user1 grouptest”，把组名作为参数放在最后。