**fdisk、parted 命令无损分区扩容**

# 1、parted 无损分区扩容，详细步骤

> **1、主要目的是对/dev/sdb1 分区进行无损扩容，在保证原有数据不损坏的情况下，扩大此分区**
> **2、当前/dev/sdb1 分区的大小为 200GB**
> **3、需求是扩容到300GB**


## 1.1 查看原始分区大小并卸载

```

[root@localhost ~]# lsblk
NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
sdb      8:16   0 465.3G  0 disk
├─sdb1   8:17   0 186.3G  0 part /mnt/disk1        #大约为200GB
└─sdb3   8:19   0 186.3G  0 part /mnt/disk3
[root@localhost ~]# df -h
Filesystem      Size  Used Avail Use% Mounted on
tmpfs           3.1G     0  3.1G   0% /run/user/0
/dev/sdb3       184G   61M  174G   1% /mnt/disk3
/dev/sdb1       184G   60M  174G   1% /mnt/disk1
# 查看一下，该分区中的数据，等扩容完成后，观察数据是否损坏
[root@localhost disk1]# ls
anaconda-ks.cfg  bak  CmdTool.log  dir  ifInfo  iperf  iperf-2.0.13-1.el7.x86_64(1).rpm  iperfScript.tar.gz  iperf.sh  lost+found  MegaCliStatus.py  se  test.sh
[root@localhost disk1]# cat ifInfo        #可以看到数据完好
em1
em2
# 接下来，正式开始扩容
[root@localhost ~]# umount /mnt/disk1
[root@localhost ~]# umount /mnt/disk3        #由于/dev/sdb3 的分区在/dev/sdb1 的后面，所以sdb1扩容，需要占用到sdb3的空间，所以要跟着一起卸载，而且sdb3的数据也会丢失。
[root@localhost ~]# lsblk
NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
sda      8:0    0 931.5G  0 disk
├─sda1   8:1    0     1G  0 part /boot/efi
├─sda2   8:2    0 748.5G  0 part /home
├─sda3   8:3    0   100G  0 part /opt
├─sda4   8:4    0    50G  0 part /
└─sda5   8:5    0    32G  0 part [SWAP]
sdb      8:16   0 465.3G  0 disk
├─sdb1   8:17   0 186.3G  0 part
└─sdb3   8:19   0 186.3G  0 part
```

## 1.2 分区扩容

```
[root@localhost ~]# parted /dev/sdb
sdb   sdb1  sdb3
[root@localhost ~]# parted /dev/sdb
GNU Parted 3.1
Using /dev/sdb
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted) print                                    #打印分区信息
Model: DELL PERC H330 Adp (scsi)
Disk /dev/sdb: 500GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags:

Number  Start   End    Size   File system  Name  Flags
 1      1049kB  200GB  200GB  ext4         1
 3      200GB   400GB  200GB  ext4         3

(parted) rm 3                #删除分区3，用于扩容，如果没有分区3，直接扩容即可
(parted) print               #再次打印分区信息
Model: DELL PERC H330 Adp (scsi)
Disk /dev/sdb: 500GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags:

Number  Start   End    Size   File system  Name  Flags
 1      1049kB  200GB  200GB  ext4 
(parted) resizepart                #resizepart 分区调整命令
Partition number? 1                #输入要调整分区的编号
End?  [200GB]? 400GB                #最后的位置，这个不是分区的大小，而是end的位置，原来的end位置为200GB，现在调到了400GB，也就是扩到了分区
(parted) print                    #再次打印分区信息，可以看大分区已经变大了            
Model: DELL PERC H330 Adp (scsi)
Disk /dev/sdb: 500GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags:

Number  Start   End    Size   File system  Name  Flags
 1      1049kB  400GB  400GB  ext4         1
(parted) quit        #退出
```

## 1.3 扩容分区的文件系统

```
[root@localhost ~]# lsblk
NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
sdb      8:16   0 465.3G  0 disk
└─sdb1   8:17   0 372.5G  0 part        #可一看到分区已经变大了
#错误的做法：如果此时你直接挂载该分区，你会发现，df下的实际可用空间并没有变大，因为，分区虽然变大了，但是文件系统却没有。
[root@localhost ~]# mount /dev/sdb1 /mnt/disk1/
[root@localhost ~]# df -h        
Filesystem      Size  Used Avail Use% Mounted on
/dev/sdb1       184G   60M  174G   1% /mnt/disk1        #可以看到大小还是没有变。
#正确的做法：
[root@localhost ~]# e2fsck -f /dev/sdb1        #先检查(修复) 扩容后的分区
e2fsck 1.42.9 (28-Dec-2013)
Pass 1: Checking inodes, blocks, and sizes
Pass 2: Checking directory structure
Pass 3: Checking directory connectivity
Pass 4: Checking reference counts
Pass 5: Checking group summary information
/dev/sdb1: 67/12214272 files (0.0% non-contiguous), 814873/48827869 blocks
[root@localhost ~]# resize2fs /dev/sdb1        #重构文件系统的大小
resize2fs 1.42.9 (28-Dec-2013)
Resizing the filesystem on /dev/sdb1 to 97655994 (4k) blocks.
The filesystem on /dev/sdb1 is now 97655994 blocks long.

[root@localhost ~]# mount /dev/sdb1 /mnt/disk1/
[root@localhost ~]# df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/sdb1       367G   67M  348G   1% /mnt/disk1        #可以看到文件系统已经发生了改变
```

## 1.4 查看数据是否损坏

```
[root@localhost ~]# cd /mnt/disk1/
[root@localhost disk1]# ls
anaconda-ks.cfg  bak  CmdTool.log  dir  ifInfo  iperf  iperf-2.0.13-1.el7.x86_64(1).rpm  iperfScript.tar.gz  iperf.sh  lost+found  MegaCliStatus.py  se  test.sh
[root@localhost disk1]# cat ifInfo        #可以看到数据完好
em1
em2
```

> **到此无损分区扩容完成。**
