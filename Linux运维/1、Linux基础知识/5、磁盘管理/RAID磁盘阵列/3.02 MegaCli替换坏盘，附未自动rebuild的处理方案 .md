**MegaCli替换坏盘，附未自动rebuild的处理方案**

[](https://www.ivistang.com/articles/314/)

在linux服务器上组的raid10阵列，需要替换一块坏盘，由于外来配置的存在，没有自动rebuild，需要先清理外来配置再强制rebuild。

# 1、正常流程

## 1.1 查看磁盘信息查找坏磁盘

```
MegaCli64 -PDList -aAll -NoLog
```

找到坏盘对应的磁盘信息Enclosure Device ID: 32和Slot Number: 4，还有Adapter: #0 

## 1.2 下线坏盘并更换

```
 MegaCli64 -PDOffline -PhysDrv[32:4] -a0
```

1PhysDrv[32:4]和-a0分别对应前一步查找到的磁盘信息 找到坏盘，物理更换磁盘，正常情况下会自动rebuild。

## 1.3查看rebuild进度 

查看rebuild进度确认是否正常rebuild 

```
MegaCli64 -PDRbld -ShowProg -PhysDrv [32:4] -a0
Rebuild Progress on Device at Enclosure 32, Slot 4 Completed 10% in 71 Minutes.
```

# 2、不能自动rebuild的处理方案

##  2.1 清理外来配置 

```
MegaCli64 -cfgforeign -clear -a0
```

# 2.2 查看丢失的物理设备信息 

```
MegaCli64 -PdGetMissing -a0
Adapter 0 - Missing Physical drives
No. Array Row Size Expected
0   2     0   476416 MB
Exit Code: 0x00
```

记录array和row信息 

## 2.3 替换丢失信息 

```
MegaCli64 -PdReplaceMissing -PhysDrv[32:4] -array2,row0 -a0
```

## 2.4 强制rebuild 

```
MegaCli64 -PDRbld -Start -PhysDrv[32:4] -a0
```

## 2.5 查看rebuild状态 

```
MegaCli64 -PDRbld -ShowProg -PhysDrv [32:4] -a0
```