# disk_usage.sh

```
#!/usr/bin/bash

#这是一个用于检测linux磁盘使用率的情况，并进行报警的程序。
#默认磁盘使用率大于等于90 就发生报警。抱紧的方式使用邮件发送。

set -u                  #使用未定义的变量将会发生报错
disk_use=$(df -Th|grep "/$"|awk '{print $6}'|cut -d "%" -f1)    #获取disk的使用率
default_monitor=90
if [ $disk_use -gt $default_monitor ];then
        python send_email.py    #执行脚本，发出邮件
fi
```

# send_email.py

```
#encoding:utf-8
# _*_ coding : utf-8 _*_
# @Time : 2022/6/30 17:45
# @Author : HackWu
# @File : test01
# @Project : python发送邮件

#无需安装第三方库
import smtplib
import ssl
from email.message import EmailMessage
def send_email(email_info):
    key=email_info.get("key")      #换成你的QQ邮箱SMTP的授权码(QQ邮箱设置里)
    EMAIL_ADDRESS=email_info.get("sender")     #换成你的邮箱地址
    EMAIL_PASSWORD=key          #邮件秘钥
    smtp=smtplib.SMTP('smtp.qq.com',25)         #邮件协议


    context=ssl.create_default_context()
    sender=email_info.get("sender")            #发件邮箱
    receiver=email_info.get("receiver")
    #收件邮箱

    subject=email_info.get("subject")             #邮件主题
    body=email_info.get("body")       #邮件正文
    msg=EmailMessage()
    msg['subject']=subject       #邮件主题
    msg['From']=sender           #发件地址
    msg['To']=receiver           #目标地址
    msg.set_content(body)        #邮件内容

    with smtplib.SMTP_SSL("smtp.qq.com",465,context=context) as smtp:
        smtp.login(EMAIL_ADDRESS,EMAIL_PASSWORD)
        smtp.send_message(msg)

if __name__ == '__main__':
    subject="给小慧的邮件";
    email_body="天天开心！！！多喝热水！！！"
    email_info={
        "sender":"hackwu@qq.com",             #发件方的邮件地址
        "key":"npavwdttamtodcig",             #发件方的SMTP服务授权码
        "receiver":"2940909979@qq.com",       #收件方的邮件地址
        "subject":subject,                    #主题内容
        "body":email_body                     #邮件正文内容
    }
    send_email(email_info)
    print("发送成功")
```