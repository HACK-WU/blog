日志类型：

①access.log 访问日志 查看统计用户的访问信息 流量

②error.log 错误日志 错误信息 重写信息

# 1、访问日志

官方文档: [http://nginx.org/en/docs/http/ngx_http_log_module.html](http://nginx.org/en/docs/http/ngx_http_log_module.html)

①查看access.log

```
shell > cd /usr/local/nginx/logs
shell > cat access.log
```

access.log日志文件内容示例

```
127.0.0.1 - [06/0ct/2017:11:46:16 +0800 GET /phpinfo.php HTTP/1.1 200 25206
"Mozilla/5.e (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko)
Chrome/62.0.3202.9 Safari/537.36"
```

②查看配置解析参数说明

```
vim nginx.conf
#定义日志格式   格式命名     详细格式参数
log_format      main      '$remote_addr - $remote_user [$time_local] "$request" '
                          '$status $body_bytes_sent "$http_referer" '
                          '"$http_user_agent" "$http_x_forwarded_for"';
#访问日志的存储路径配置调用的日志格式
#access_log  logs/access.log  main;
参数                意义
$remote_addr        客户端的ip地址(代理服务器，显示代理服务ip)
$remote_user        用于记录远程客户端的用户名称（一般为“-”）
$time_local         用于记录访问时间和时区
$request            用于记录请求的url以及请求方法
$status             响应状态码，例如：200成功、404页面找不到等。
$body_bytes_sent    给客户端发送的文件主体内容字节数
$http_user_agent    用户所使用的代理（一般为浏览器)
$http_x_forwarded_for        可以记录客户端IP，通过代理服务器来记录客户端的ip地址
$http_referer            可以记录用户是从哪个链接访问过来的
访问日志，可以统计分析用户的流量的相关情况。客情分析
```

# 2、错误日志

记录一些启动和运行过程中的错误信息

官方文档：<[http://nginx.org/en/docs/ngx_core_module.html#error_log](http://nginx.org/en/docs/ngx_core_module.html#error_log)

```
shell > cat /usr/local/nginx/logs/error.log
```

```
# 定义开启错误日志    日志位置    日志级别
#error_log     logs/error.log;
#error_log     logs/error log     notice;
#error_log     logs/error.log     info;
```

# 3、日志切割

## 3.1 基于域名日志切割

①开启日志的定义规则

```
log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';
```

②重启nginx测试查看

```
#访问日志的存储路径配置
调用的日志格式
#在server段里面配置 也就是在当前server里的访问日志，会被写入定义的这里
access log logs/shop .lnmp.com_access .log mylogs;
```