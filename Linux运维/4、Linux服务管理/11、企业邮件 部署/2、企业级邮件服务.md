

发送方配置


1. DNS 搭建


2. 安装 gcc 以及其他依赖软件


3. 将 web 页面放到 Apache 的网页目录下


4. 将成品数据库文件导入到 MySQL 中 中 （ 没设置密码 ，空密码登录） ）


5. 邮件模板拷贝到邮件服务器的主目录下


6. 创建映射用户& 修改配置文件 件


7. 重启服务& 发送邮件测试& 查看结果


接收方配置


1. 装安装 dovecot 相关软件


2. 配置 dovecot 能够去数据库里读数据


1) 修改/etc/dovecot/conf.d/10-mail.conf


2) 修改/etc/dovecot/conf.d/10-auth.conf


3) 修改数据库连接配置文件（需要拷贝模板生成）


3. 重启 dovecot 验证 是否能连接


MAIL+WEB 页面


1. 修改/etc/httpd/conf/httpd.conf 配置文件 ，能件 加载邮件 web 页面


2. extmail 目录改 中更改 cgi 的属组属主，让 vmail 有权限执行


3. extman 中更改 cgi 的属组属主，让 vmail 有权限执行


4. 安装 Unix-Syslog 软件


5. 在浏览器上访问， ，windows 测试需要 手动向 指向 dns 服务器

前提条件：要有一个 DNS 服务器 ，将准备好的软件包导入虚拟机







---

# 发送方配置


# 1. DNS 搭建


```javascript
# yum -y install bind
# vi /etc/named.conf
修改监听地址和访问控制为 any

# vi /etc/named.rfc1912.zones
使用 extmail.org作为解析域，只保留正向解析即可

# vi /var/named/extmail.localhost
修改数据文件，如下
NS dns.extmail.org.
MX 3 mail.extmail.org.
dns A 192.168.88.10
mail A 192.168.88.10
```

在另一台上使用 nslookup 测试 dns 是否能解析




# 2. 安装 gcc 以及其他依赖软件


```javascript
# yum -y install gcc* mysql-server mysql httpd mailx
启动 MySQL（Apache）并设置开机自启
# chkconfig mysqld(httpd) on
# service mysqld(httpd) start
```



# 3. 将 web 页面放到 Apache 的网页目录下


```javascript
# mkdir -p /var/www/extsuite
创建一个单独的目录
# tar -xf extmail-1.2.tar.gz -C /var/www/extsuite/
# tar -xf extman-1.1.tar.gz -C /var/www/extsuite/
将 extmail 和 extman 解压到创建的长度目录中
# cd /var/www/extsuite
# mv extmail-1.2/ extmail
# mv extman-1.1/ extman
# chown -R root.root *
将两个解压后的目录去掉版本号，并修改文件归属
```



# 4. 将成品数据库文件导入到 MySQL 中 中 （ 没设置密码 ，空密码登录） ）


```javascript
# cd /var/www/extsuite/
# mysql < ./extman/docs/extmail.sql
将./extman/docs 中模板和数据导入到数据库中

# vi ./extman/docs/init.sql
INSERT INTO `manager` VALUES (‘root@extmail.org’,’123456’,’admin’,’root’)
将此文件中该位置的密码修改为 123456，切记先修改，再导入

# mysql < ./extman/docs/init.sql
```






# 5. 邮件模板拷贝到邮件服务器的主目录下


```javascript
# cd /var/www/extsuite/extman/docs/
# cp -a mysql_virtual_alias_maps.cf mysql_virtual_domains_maps.cf mysql_virtual_mailbox_maps.cf
/etc/postfix/
```



# 6. 创建映射用户& 修改配置文件 件


```javascript
# useradd -u 600 -s /sbin/nologin vmail
# vim /etc/postfix/main.cf
inet_interfaces = all 		#将此选项取消注释
#inet_interfaces = localhost 	#将此选项注释掉
在尾部添加下列内容
virtual_mailbox_base = /home/vmail
virtual_uid_maps = static:600
virtual_gid_maps = static:600
virtual_alias_maps = mysql:/etc/postfix/mysql_virtual_alias_maps.cf
virtual_mailbox_domains = mysql:/etc/postfix/mysql_virtual_domains_maps.cf
virtual_mailbox_maps = mysql:/etc/postfix/mysql_virtual_mailbox_maps.cf
```

# 7. 重启服务& 发送邮件测试& 查看结果


```javascript
# service postfix restart
# echo "hello" | mail -s test support@extmail.org
# ls /home/vmail/extmail.org/postmaster/Maildir/new/
```



---

# 接收方配置


# 1. 装安装 dovecot 相关软件


```javascript
# yum -y install dovecot dovecot-devel dovecot-mysql
# chkconfig dovecot on
# service dovecot start
```

# 2. 配置 dovecot 能够去数据库里读数据


## 1) 修改/etc/dovecot/conf.d/10-mail.conf


在配置文件中增加下列两行


```javascript
mail_location = maildir:/home/vmail/%d/%n/Maildir #定义 dovecot 查询邮件的位置（顶头写）
first_valid_uid = 600
```

## 2) 修改/etc/dovecot/conf.d/10-auth.conf


```javascript
!include auth-sql.conf.ext #取消调用数据库的记录注释
```

## 3) 修改数据库连接配置文件（需要拷贝模板生成）


```javascript
# cp -a /usr/share/doc/dovecot-2.0.9/example-config/dovecot-sql.conf.ext /etc/dovecot/
cd   /etc/dovecot
# vim dovecot-sql.conf.ext #将下列内容加入配置文件即可
driver = mysql
驱动类型
connect = host=localhost dbname=extmail user=extmail password=extmail
 
连接数据库的信息
default_pass_scheme = MD5
password_query = \
SELECT username, domain, password \
FROM mailbox WHERE username = '%u' AND domain = '%d'
验证登录密码的查询命令
user_query = SELECT maildir, 600 AS uid, 600 AS gid FROM mailbox WHERE username = '%u'
查询虚拟用户对应的邮箱目录
```

# 3. 重启 dovecot 验证 是否能连接


安装 telnet 客户端进行登录验证


```javascript
# yum -y install telnet
service dovecot restart
# telnet mail.extmail.org 110
user postmaster@extmail.org #登录 postmaster 用户
pass extmail #密码是 extmail
retr 1 #查看第一封邮件
```



---

# MAIL+WEB 页面


# 1. 修改/etc/httpd/conf/httpd.conf 配置文件 ，能件 加载邮件 web 页面


```javascript
NameVirtualHost *:80 	#取消注释，开启虚拟主机功能
添加一下内容
<VirtualHost *:80>
DocumentRoot /var/www/extsuite/extmail/html
ServerName mail.extmail.org
scriptalias /extmail/cgi /var/www/extsuite/extmail/cgi
alias /extmail /var/www/extsuite/extmail/html
scriptalias /extman/cgi /var/www/extsuite/extman/cgi
alias /extman /var/www/extsuite/extman/html
suexecusergroup vmail vmail
</VirtualHost>
```

# 2. extmail 目录改 中更改 cgi 的属组属主，让 vmail 有权限执行


```javascript
# chown -R vmail.vmail cgi/
# cp -a webmail.cf.default  webmail.cf
SYS_MAILDIR_BASE = /home/vmail 	#邮件存放目录
SYS_CRYPT_TYPE = plain 		#加密类型
SYS_MYSQL_USER = extmail 		#MySQL 用户名
SYS_MYSQL_PASS = extmail 		#MySQL 密码
```

# 3. extman 中更改 cgi 的属组属主，让 vmail 有权限执行


```javascript
# chown -R vmail.vmail cgi/
# cp -a webman.cf.default webman.cf

# vim webman.cf
SYS_MAILDIR_BASE = /home/vmail
SYS_SESS_DIR = /tmp
SYS_CAPTCHA_ON = 0 #生产环境中开启，实验环境无法显示校验码
SYS_CRYPT_TYPE = plain
```

# 4. 安装 Unix-Syslog 软件


解压缩 Unix-Syslog-1.1.tar.gz 软件


```javascript
# cd Unix-Syslog-1.1
# perl Makefile.PL
# make
# make install
```

# 5. 在浏览器上访问， ，windows 测试需要 手动向 指向 dns 服务器