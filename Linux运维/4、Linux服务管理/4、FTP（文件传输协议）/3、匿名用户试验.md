# **1、匿名权限控制：****(默认根目录就是自己的家目录，不能随意切换目录）******

```javascript
anonymous_enable=YES	 	#启用匿名访问
anon_umask=022 		 	#匿名用户所上传文件的权限掩码
anon_root=/var/ftp 	 	#匿名用户的 FTP 根目录
anon_upload_enable=YES 	 	#允许上传文件
anon_mkdir_write_enable=YES 	#允许创建目录
anon_other_write_enable=YES 	#开放其他写入权限(删除、覆盖、重命名)
anon_max_rate=0		 	#限制最大传输速率（0 为不限速，单位：bytes/秒）
```

- **在windows的资源管理器中，复制空文件夹属于****创建目录操作****。**

- **如果复制的文件夹中有文件，那么其中的文件，不会被复制过去**

- **如果想在windows的资源管理器中，想将目录连同其中的文件夹中的文件，一同复制到vsftpd中，**

- **需要对该用户，同时开启，创建目录权限，写入权限和上传文件权限。**

- **anon_upload_enable=YES**

- **anon_mkdir_wirte_enable=YES**

- **anon_other_witer_enable=YES**

**BUG问题：**

- **开启了上面三个权限。匿名用户就可以对，所在原本所在目录中的文件，进行任意操作，比如删除，重命名，写入等等。**

- **但是如果有一个****非空目录dir****，则匿名用户无法删除。**

- **解决办法：**

- **方法一：**

- **配置文件中写入：****anon_umask=022**

- **这样匿名用户上传的目录权限，自动为755，就可以直接执行删除目录了。**

- **方法二：**

- **先进入到dir目录中，然后清空里面的文件。**

- **再退出那个目录，在进行删除目录操作。**

- **方法三：（****这种方法，不现实）**

- **在linux端，修改权限，chmod 755 dir**

- **然后匿名就可以在客户端，进行删除操作。**

# **2、实验 需求与 流程：**** (关闭防火墙和SELINUX）**

**环境准备：**

```javascript
server ：yum install -y  vsftpd
client : yum install -y  ftp
```

# ****

**注意：在客户端登录后，默认情况下是可以下载的，但不能上传ab	**

```javascript
a. anon_upload_enable=YES
b. 在/var/ftp/下创建上传目录
c. 修改上传目录的权限或所有者，让匿名用户有写入权限
```

- **vi /etc/vsftpd/vsftpd.conf**

```javascript
[root@bogon ftp]# vi /etc/vsftpd/vsftpd.conf 

# obviously need to create a directory writable by the FTP user.
anon_upload_enable=YES                 #更改此处
#
```

- **创建专门上传文件的目录： mkdir   /var/ftp/upload ****严禁直接修改ftp目录的权限；**

- **给upload目录赋予权限：chmod o+w(757) uoload;**

```javascript
[root@bogon ftp]# mkdir  upload
[root@bogon ftp]# chmod o+w upload/
[root@bogon ftp]# ll
drwxr-xrwx. 2 root root 4096 8月  22 07:39 upload
```

## **2)****实现创建目录和 实现创建目录和 文件 其他操作******

```javascript
anon_mkdir_write_enable=YES 	#允许创建目录
anon_other_write_enable=YES 	#删除文件、文件改名、文件覆盖
```

## **3)****用户进入某个文件夹时，弹出相应的说明 用户进入某个文件夹时，弹出相应的说明******

```javascript
a. 在对应目录下创建 .message 文件，并写入相应内容
b. 确认dirmessage_enable=YES是否启用
c. 尝试却换目录查看效果（同一次登录仅提示一次）
```

## **4) ****实现上传的文件可下载 实现上传的文件可下载******

默认情况下开放上传权限后，上传的文件是无法被下载的，因为文件的其他人位置没有r权限

设置

# **5、FTP的配置文件详解（重要）**

在Server服务器端，使用rpm -ql vsftpd

```javascript
# rpm -ql vsftpd
/usr/lib/systemd/system/vsftpd.service 	启动脚本
/etc/vsftpd				配置文件的目录
/etc/vsftpd/ftpusers			用户列表文件，黑名单
/etc/vsftpd/user_list			用户列表文件，可黑可白（默认是黑名单）
/etc/vsftpd/vsftpd.comf			配置文件(主配置文件)
/usr/sbin/vsftpd				程序本身（二进制的命令）
/var/ftp					匿名用户的默认数据根目录
/var/ftp/pub				匿名用户的扩展数据目录
```