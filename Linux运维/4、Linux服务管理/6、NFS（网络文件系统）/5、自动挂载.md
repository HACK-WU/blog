## **自动挂载**

可使用autofs服务按需要挂载外围设备，NFS共享等，并在空闲5分钟后后自动卸载

### **1）相关包和文件**

- 软件包: autofs

- 服务文件: /usr/lib/systemd/system/autofs.service

- 配置文件: /etc/auto.master

### **2）配置文件格式**

参看帮助: man 5 autofs

所有导出到网络中的NFS启用特殊匹配-host至"browse"

范例: /net目录可以自动挂载NFS共享

```
cat /etc/auto.master
/net   -hosts
cd /net/192.168.175.147
```

- 自动挂载资源有两种格式

- 相对路径法:将mount point路径分成dirname和basename分别配置，可能会影响现有的目录结构

- 绝对路径法:直接匹配全部绝对路径名称,不会影响本地目录结构

### **3）相对路径法**

- /etc/auto.master 格式 ：挂载点的dirname  指定目录的配置文件路径

- 指定目录的配置文件格式 ：挂载点的basename  挂载选项  选项设备

案例

相对路劲：

```
vim /etc/auto.master
/misc  /etc/auto.misc
vim /etc/auto.misc
cd    -fstype=iso9660,ro,nosuid,nodev  :/dev/cdrom
```

- 相对路径法为支持通配符

```
vim /etc/auto.master
/misc  /etc/auto.misc
vim /etc/auto.misc
# 表示/misc下面的子目录和nfs共享/export目录的子目录同名
*   server:/export/&
```

### **4）绝对路劲法**

- /etc/auto.master格式 ：/-   指定配置文件路径

- 指定配置文件格式 ：绝对路径   挂载选项   选项设备

案列：

- 绝对路径法

```
vim /etc/auto.master
/-   /etc/auto.direct
vim /etc/auto.direct
/nfsdir    -fstype=nfs  server1:/export/nfsdir
```

## **8）实战案例**

将NFS的共享目录，通过autofs 发布出来，做为远程主机用户的家目录

![](images/WEBRESOURCE9420e4ed3abe02e498da4a19503f3c56截图.png)

### **1、环境准备**

将node1中的用户家目录共享出来，node2在登陆这个用户的到时候，看到家目录下的文件是一致的

## **2、步骤**

- NFS服务器创建用户和相应的目录，将用户user的家目录共享

```
[root@NFSserver ~]# mkdir /data
[root@NFSserver ~]# useradd -d /data/user user
[root@NFSserver ~]# id user
uid=1000(user) gid=1000(user) 组=1000(user)
[root@NFSserver ~]# vim /etc/exports.d/test.exports
/data/user  *(rw,anonuid=1000,anongid=1000,all_squash)
```

- 在nfs客户端上实现autofs

```
[root@NFSclient ~]# vim /etc/auto.master
/data  /etc/auto.home
[root@NFSclient ~]# vim /etc/auto.home
*  -fstype=nfs,vers=3  192.168.175.144:/data/user&
```

- 在nfs客户端上创建用户user

```
[root@NFSclient ~]# mkdir /data
[root@NFSclient ~]# useradd -d /data/user -u 1000 user
```

- 测试是否完成目标

```
[root@NFSserver ~]# su - user
[user@NFSserver ~]$ touch file
# 在NSF服务器上登录user用户，创建文件在家目录中
[root@NFSclient /]# su - user
[user@NFSclient ~]$ ll
总用量 0
-rw-rw-r--. 1 user user 0 4月 30 10:13 file
# 在NSF客户机上登录user
```