**署安装以及基本命令**

# 1、二进制安装

下载地址：[https://www.mongodb.com/try/download/community](https://www.mongodb.com/try/download/community)

## 1）准备软件包，上官网下载软件包

```
[root@server1 ~]# wget https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-
rhel70-4.4.4.tgz
```

## 2）关闭防火墙和selinux

```
[root@server1 ~]# systemctl stop firewalld
[root@server1 ~]# setenforce 0
```

## 3）关闭大叶内存机制

```
[root@server1 ~]# sudo mkdir /etc/tuned/virtual-guest-no-thp
[root@server1 ~]# vim /etc/tuned/virtual-guest-no-thp/tuned.conf
[main]
include=virtual-guest
[vm]
transparent_hugepages=never
[root@server1 ~]# sudo tuned-adm profile virtual-guest-no-thp
[root@server1 ~]# cat /sys/kernel/mm/transparent_hugepage/enabled    
always madvise [never]
[root@server1 ~]# cat /sys/kernel/mm/transparent_hugepage/defrag
[always] madvise never
参考文档：https://docs.mongodb.com/manual/tutorial/transparent-huge-pages/
```

## 4）准备用户

```
[root@server1 ~]# useradd mongod
[root@server1 ~]# passwd mongod
更改用户 mongod 的密码 。
新的 密码：
无效的密码： 密码是一个回文
重新输入新的 密码：
passwd：所有的身份验证令牌已经成功更新。
```

## 5）主备目录结构

```
[root@server1 ~]# mkdir -p /mongodb/{conf,log,data}
```

## 6）解压压缩包，并将bin目录复制到/mongodb/下

```
[root@server1 ~]# tar xvf mongodb-linux-x86_64-rhel70-4.4.4.tgz
[root@server1 ~]# cp -r mongodb-linux-x86_64-rhel70-4.4.4/bin /mongodb/
```

## 7）移动解压后的文件夹到指定的目录中

```
[root@server1 ~]# mkdir /usr/local/mongodb
[root@server1 ~]# mv mongodb-linux-x86_64-rhel70-4.4.4/* /usr/local/mongodb/
```

## 8）设置目录结构权限

```
[root@server1 ~]# chown -R mongod:mongod /mongodb 
```

## 9）设置新用户环境变量

```
[root@server1 ~]# su - mongod 
[mongod@server1 ~]$ vim .bash_profile
export PATH=/mongodb/bin:$PATH
[mongod@server1 ~]$ source .bash_profile
```

## 10）启动mongodb

```
[mongod@server1 ~]$ mongod --dbpath=/mongodb/data --
logpath=/mongodb/log/mongodb.log --port=27017 --logappend --fork
```

## 11）登录mongodb

```
[mongod@localhost ~]$ mongo
```

## 12）关闭

```
[mongod@localhost ~]$ mongod --dbpath=/mongodb/data --
logpath=/mongodb/log/mongodb.log --port=27017 --logappend --shutdown
```

## 13）配置文件解释

```
YAML模式
NOTE：
YAML does not support tab characters for indentation: use spaces instead.
--系统日志有关 
systemLog:
 destination: file    
 path: "/mongodb/log/mongodb.log"   --日志位置
 logAppend: true           --日志以追加模式记录
--数据存储有关 
storage:
 journal:
  enabled: true
 dbPath: "/mongodb/data"       --数据路径的位置
-- 进程控制 
processManagement:
 fork: true             --后台守护进程
 pidFilePath: <string>        --pid文件的位置，一般不用配置，可以去掉这行，
自动生成到data中
 
--网络配置有关 
net:      
 bindIp: <ip>            -- 监听地址
 port: <port>            -- 端口号,默认不配置端口号，是27017
-- 安全验证有关配置   
security:
authorization: enabled        --是否打开用户名密码验证
------------------以下是副本集与分片集群有关---------------------- 
replication:
oplogSizeMB: <NUM>
replSetName: "<REPSETNAME>"
secondaryIndexPrefetch: "all"
sharding:
 clusterRole: <string>
 archiveMovedChunks: <boolean>
  
---for mongos only
replication:
    localPingThresholdMs: <int>
sharding:
 configDB: <string>
---
```

## 14）使用配置文件启动服务

```
[root@server1 ~]# vim /mongodb/conf/mongo.conf
systemLog:
 destination: file
 path: "/mongodb/log/mongodb.log"
 logAppend: true
storage:
 journal:
  enabled: true
 dbPath: "/mongodb/data/"
processManagement:
 fork: true
net:
 port: 27017
 bindIp: 192.168.80.10,127.0.0.1
[mongod@server1 ~]$ mongod -f /mongodb/conf/mongo.conf
about to fork child process, waiting until server is ready for connections.
forked process: 1676
child process started successfully, parent exiting
[mongod@server1 ~]$ mongod -f /mongodb/conf/mongo.conf --shutdown
```

# 2、yum安装

## 1）准备yum仓库

```
[mngodb-org]
name=MongoDB Repository
baseurl=http://mirrors.aliyun.com/mongodb/yum/redhat/7Server/mongodb-
org/4.0/x86_64/
gpgcheck=0
enabled=1
```

## 2）更新yum仓库

```
[root@localhost ~]# yum update 
```

## 3）使用yum安装

```
[root@localhost ~]# yum install mongodb-org 
```