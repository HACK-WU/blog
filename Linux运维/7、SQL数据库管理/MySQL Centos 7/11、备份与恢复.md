**备份与恢复**

# 1、备份方式

- 按照备份数据位置分类

- 热备：硬盘以及内存中的⼀些数据进⾏备份

- 冷备：数据库硬盘中的数据

- 按照备份后⽂件的内容

- 逻辑备份：⼀般内容分是sql语句

- 裸⽂件备份：拷⻉数据库的物理文件，⼀般内容是⼆进制数据

- 按照备份数据的内容

- 完全备份：对数据库进⾏⼀个完整的备份

- 增量备份：在上次的完全备份基础上对更新的数据进⾏备份

- ⽇志备份：⼆进制⽇志备份-->当数据库宕机之后进⾏数据恢复的依据

- 冷备份的优点：

- 备份简单，只要拷⻉相关⽂件即可

- 易于跨平台

- 恢复简单，只要把⽂件恢复到相关位置即可

- 恢复速度快，不需要执⾏任何sql语句，也不需要重新建索引

- 冷备份缺点

- 冷备⽂件通常⽐逻辑⽂件⼤很多

- 不是总可以轻易跨平台

- 逻辑备份：

- mysqldump

- selcet * into outfile 'path/to/file' from tbname;

- 

# 2、使用mysqldump工具备份

mysqldump备份数据库的原理是把数据（包括库表）从MySQL库里以sql语句的形式直接输出或者

生产备份文件的过程，这种备份成sql的方式称为逻辑备份。

![](images/WEBRESOURCE26d26adb6a131546961797662cef0482截图.png)

## 1）不带参数备份单个数据库

```
[root@localhost ~]# mysqldump test > test_db_bak.sql
# 可以打开看看备份的数据
[root@localhost ~]# cat test_db_bak.sql | grep -Ev "#|\*|--|^$"
DROP TABLE IF EXISTS `test_tb`;
CREATE TABLE `test_tb` (
 `id` int(11) DEFAULT NULL,
 `name` char(20) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=gb2312;
LOCK TABLES `test_tb` WRITE;
INSERT INTO `test_tb` VALUES (1,'??'),(2,'lisi'),(4,'尼古拉赵四'),(3,'王二麻'),
(5,'谢大脚'),(6,'谢广坤');
UNLOCK TABLES;
[root@localhost ~]#
```

## 2）加-B参数备份多个数据库

加-B参数的作用是增加创建数据库和连接数据库的语句，后面可以直接接多个库名，同时备份多个数据库

```
使用-B参数备份的数据会增加两行语句
CREATE DATABASE /*!32312 IF NOT EXISTS*/ `test` /*!40100 DEFAULT CHARACTER
SET gbk */;
USE `test`;
```

## 3）使用gzip压缩备份数据

```
[root@localhost ~]# mysqldump -B test | gzip> test_db_bak.sql.gz
[root@localhost ~]# ll -h
总用量 12K
-rw-------. 1 root root 1.4K 12月  2 15:04 anaconda-ks.cfg
-rw-r--r--. 1 root root 2.1K 12月  3 23:33 test_db_bak.sql
-rw-r--r--. 1 root root  824 12月  3 23:38 test_db_bak.sql.gz
```

## 4）备份多个表或者多个表

```
# 备份单个表
mysqldump 数据库名 表名 > 备份文件名
# 备份多个表
mysqldump 数据库名 表名1 表名2 … > 备份文件名
```

# 3、恢复

- 将sql语句重新执行一遍，则完成数据恢复

- 可以选择在客户端使用客户端工具运行sql脚本

- 可以在数据库服务器里面执行source命令；