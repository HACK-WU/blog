**常用模块**

ansible的执行状态

- 绿色：执行成功并且不需要做改变的操作

- 黄色：执行成功并且对目标主机做变更

- 红色：执行失败

- 粉色：警告信息

- 蓝色：显示ansible命令执行的过程

## 1、ping 模块：主机连通性测试

```
[root@server1 ~]# ansible -m ping nodes 
```

## 2、user 模块

```
[root@node1 ~]# ansible-doc -s user
comment   # 用户的描述信息
createhom  # 是否创建家目录
force    # 在使用`state=absent'是, 行为与`userdel --force'一致. 
group    # 指定基本组 
groups   # 指定附加组，如果指定为('groups=')表示删除所有组 
home    # 指定用户家目录
name        # 指定用户名
password     # 指定用户密码
remove      # 在使用 `state=absent'时, 行为是与 `userdel --remove'一致.
shell      # 指定默认shell
state      #设置帐号状态，不指定为创建，指定值为absent表示删除
system      # 当创建一个用户，设置这个用户是系统用户。这个设置不能更改现有用户
uid       #指定用户的uid  
update_password  # 更新用户密码
expires     #指明密码的过期时间
1.添加系统用户，指定uid、家目录、主组及注释
ansible -m user -a "system=yes name=zhangsan home=/home/zhangsan uid=111
group=zhangsan comment='hello zhangsan'" nodes
2.删除用户及家目录
ansible -m user -a "name=zhangsan state=absent remove=yes"
```

## 3、group

```
root@node1 ~]# ansible-doc -s group 
- name: 添加或删除组  
action: group   
gid    # 设置组的GID号   
name=   # 管理组的名称   
state   # 指定组状态，默认为创建，设置值为absent为删除   
system   # 设置值为yes，表示为创建系统组
ansible -m group -a "name=eagles gid=111 system=yes" nodes
ansible -m group -a "name=eagles gid=111 state=absent" nodes
```

## 4、command

1.默认使用的模块

**2.不支持管道，变量及重定向等**

```
[root@node1 ~]# ansible-doc -s command - name: Executes a command on a
remote node
```

## 5、shell

1.调用bash执行命令

2.但是某些复杂的操作即使使用shell也可能会失败

解决方法：将操作写到脚本中，通过script模块

## 6、script

```
free_form参数:     必须参数，指定需要执行的脚本，脚本位于 ansible 管理主机本地，并没有具体的
                     一个参数名叫 free_form，具体解释请参考 command 模块。
chdir参数:       此参数的作用就是指定一个远程主机中的目录，在执行对应的脚本之前，会先进入到chdir 参数指定的目录中。
creates参数:     使用此参数指定一个远程主机中的文件，当指定的文件存在时，就不执行对应脚本，可参考 command 模块中的解释。
removes参数:     使用此参数指定一个远程主机中的文件，当指定的文件不存在时，就不执行对应脚本，可参考 command 模块中的解释。
[root@server1 ~]# ansible -m script -a '/root/test.sh chdir=/tmp  creates=test2' server2
```

## 7、copy

```
[root@node1 ~]# ansible-doc -s copy 
backup：    在覆盖之前，将源文件备份，备份文件包含时间信息。   
content：    用于替代“src”，可以直接设定指定文件的值   
dest：        必选项。要将源文件复制到的远程主机的绝对路径   
directory_mode：    递归设定目录的权限，默认为系统默认权限   
force：    强制覆盖目的文件内容，默认为yes   
others：    所有的file模块里的选项都可以在这里使用   
src：    被复制到远程主机的本地文件，可以是绝对路径，也可以是相对路径。如果路径是一个目录，它将递归 复制
ansible -m copy -a "src=/本地文件 dest=/远程文件" nodes
```

### 3）在创建文件时修改文件的属主和属组信息

```
[root@server1 ~]# ansible -m copy -a "src=/root/test.sh dest=/root/test1 owner=zhangsan group=eagles" server2
```

### 4）在传输文件时修改文件的权限信息，并且备份远程主机文件

```
[root@server1 ~]# ansible -m copy -a "src=/root/test.sh dest=/root/test1 backup=yes mode=1777" server2
```

### 5）创建一个文件并直接编辑文件

```
[root@server1 ~]# ansible -m copy -a "content='hello eagles' dest=/root/test1" server2
```

## 8、file

```
[root@node1 ~]# ansible-doc -s file 
- name: Sets attributes of files  
 force：    需要在两种情况下强制创建软链接，一种是源文件不存在，但之后会建立的情况下；另一
            种是目标软链接已存在，需要先取消之前的软链，然后创建新的软链，有两个选项：yes|no   
 group：    定义文件/目录的属组   
 mode：    定义文件/目录的权限   
 owner：    定义文件/目录的属主   
 path：    必选项，定义文件/目录的路径   
 recurse：    递归设置文件的属性，只对目录有效   
 src：    被链接的源文件路径，只应用于state=link的情况   
 dest：    被链接到的路径，只应用于state=link的情况   
state： 
    -absent:     删除文件
     -directory：    如果目录不存在，就创建目录    
     -file：    验证文件是否存在，即使文件不存在，也不会被创建    
     -link：    创建软链接    
     -hard：    创建硬链接    
     -touch：    如果文件不存在，则会创建一个新的文件，如果文件或目录已存在，则更新其后修改时间
```

### 1）创建目录

```
[root@server1 ~]# ansible -m file -a "name=test1 owner=root group=root mode=1644 state=directory " server2
```

### 2）创建文件

```
[root@server1 ~]# ansible -m file -a "path=/root/test2 owner=root group=root mode=1644 state=touch" server2
```

### 3）删除文件

```
[root@server1 ~]# ansible -m file -a "path=/root/test2 owner=root group=root mode=1644 state=absent" server2
```

### 4）创建软链接文件

```
[root@server1 ~]# ansible -m file -a "src=/root/test1 dest=/root/test2 state=link" server2
```

### 5）创建硬链接文件

```
[root@server1 ~]# ansible -m file -a "src=/root/test.txt dest=/root/test2 state=hard" server2
```

### 6）yum

```
[root@node1 ~]# ansible-doc -s yum 
 conf_file     #设定远程yum安装时所依赖的配置文件。如配置文件没有在默认的位置。
 disable_gpg_check   #是否禁止GPG checking，只用于`present' or `latest'。
 disablerepo  #临时禁止使用yum库。 只用于安装或更新时。   
 enablerepo   #临时使用的yum库。只用于安装或更新时。   
  name=       #所安装的包的名称   
 state        #present安装（默认选项）， latest安装新的, absent 卸载软件。   
 update_cache  #强制更新yum的缓存
ansible -m yum -a "name=httpd state=latest" nodes
```

## 9、service

```
[root@node1 ~]# ansible-doc service 
> SERVICE  (/usr/lib/python2.7/site-
packages/ansible/modules/system/service.py)
   Controls services on remote hosts. Supported init systems include
BSD init, OpenRC, SysV, Solaris     
   SMF, systemd, upstart. For Windows targets, use the [win_service]
module instead.
* note: This module has a corresponding action plugin.   
arguments     #命令行提供额外的参数   
enabled      #设置开机启动，可以设置为yes或者no。   
 name=       #服务名称   
runlevel      #开机启动的级别，一般不用指定。   
 sleep       #在重启服务的过程中，是否等待。如在服务关闭以后等待2秒再启动。  
state       #started启动服务， stopped停止服务， restarted重启服务， reloaded重载配置
ansible -m service -a "name=httpd state=started" nodes
```

## 10、selinux

```
[root@node1 ~]# ansible-doc -s selinux
# selinux模块针对selinux的修改操作是针对配置文件进行修改的
- name: Change policy and state of SELinux  
selinux:    
 configfile:          # path to the SELinux configuration file, ifnon-standard    
 policy:         # name of the SELinux policy to use   
    -target     #定向的，如果state不是enforcing或者permissive,基于需要加上policy:target
state:         # (required) The SELinux mode
    -disabled   #失效的
    -enforcing  #强制的
    -permissive  #宽容的
```

### 举例：

```
- name: Enable SELinux     
  ansible.posix.selinux:
    policy: targeted
    state: enforcing
- name: Put SELinux in permissive mode, logging actions that would be blocked.
  ansible.posix.selinux:
    policy: targeted
    state: permissive
- name: Disable SELinux
  ansible.posix.selinux:
    state: disabled
```

### 1）setup

```
ansible -m setup nodes  #获取远程主机的详细信息
ansible-doc -l # 可以查询ansible具有的所有模块
    选型 filter:可以过滤想要得到的信息
```

[https://docs.ansible.com/ansible/latest/index.html](https://docs.ansible.com/ansible/latest/index.html) # 官方文档