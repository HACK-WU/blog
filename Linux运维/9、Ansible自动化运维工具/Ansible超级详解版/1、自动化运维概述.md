# 任务背景

公司的服务器越来越多, 维护一些简单的事情都会变得很繁琐。用shell脚本来管理少量服务器效率还行, 服务器多了之后, shell脚本无法实现高效率运维。这种情况下，我们需要引入**==自动化运维==**工具, 对多台服务器实现高效运维。

![1552300935879](图片/架构图.png)

# 任务要求

通过管理服务器能够按照需求灵活高效地管理所有应用服务器的运维操作



# 任务拆解

1,  需要一台服务器做管理端, 来连接管理所有的应用服务器

2,  考虑如果只针对一部分应用服务器进行运维操作如何实现(服务器分组)

3,  学会将平台烂熟于心的linux操作命令转化为自动化运维的方式(常见模块的学习)

4,  如果操作非常的冗长, 学会使用playbook和role的方式来管理



# **学习目标**

- [ ] 能够安装ansible服务器和客户端
- [ ] 能够定义ansible主机清单进行服务器分组
- [ ] 能够使用hostname模块修改主机名
- [ ] 能够使用file模块做基本的文件操作
- [ ] 能够使用copy模块把文件拷贝到远程机器
- [ ] 能够使用fetch模块把文件从远程拷贝到本地
- [ ] 能够使用user模块管理用户
- [ ] 能够使用group模块管理用户组
- [ ] 能够使用cron模块管理时间任务
- [ ] 能够使用yum_repository模块配置yum
- [ ] 能够使用yum模块安装软件包
- [ ] 能够使用service模块控制服务的启动,关闭,开机自启动

- [ ] 能够使用script模块在远程机器上执行本地脚本

- [ ] 能够使用command与shell模块远程执行命令

- [ ] 能够编写playbook实现httpd

- [ ] 能够使用roles实现lamp



# 一、认识自动化运维

**问题:** 

假设我要去1000台服务上做一个操作（如nginx服务器修改配置文件里的某一个参数), 下面两种方法缺点明显:

1. 按传统的方法, 一台连着一台服务器的ssh上去手动操作。 

   缺点:  

   * 效率太低。

2. 写个shell脚本来做。

   缺点: 

   * 管理的机器平台不一致，脚本可能不具备通用性。

   * 传密码麻烦(在非免密登录的环境下, 需要expect来传密码)

   * 效率较低，循环1000次也需要一个一个的完成，如果用`&`符放到后台执行，则会产生1000个进程。



**自动化运维**: 将日常IT运维中大量的**重复性工作**，小到简单的日常检查、配置变更和软件安装，大到整个变更流程的组织调度，由过去的手工执行转为自动化操作，从而减少乃至消除运维中的延迟，实现“零延时”的IT运维。



## 自动化运维主要关注的方面

假如管理很多台服务器，主要关注以下几个方面:

1. **管理机与被管理机的连接**(管理机如何将管理指令发送给被管理机)

2. **服务器信息收集**  (如果被管理的服务器有centos7.5外还有其它linux发行版,如suse,ubuntu等。当你要做的事情在不同OS上有所不同,你需要收集信息,并将其分开处理)

3. **服务器分组**（因为有些时候我要做的事情不是针对所有服务器,可能只针对某一个分组） 

4. **管理内容的主要分类**
* **文件目录管理**(包括文件的创建,删除,修改,查看状态,远程拷贝等)
  
* **用户和组管理**
* **cron时间任务管理**					
  
* **yum源配置与通过yum管理软件包**
  
* **服务管理**
  
* **远程执行脚本**
  
* **远程执行命令**







## **常见的开源自动化运维工具比较** 

1. puppet(拓展)	

   基于ruby语言，成熟稳定。适合于大型架构，相对于ansible和saltstack会复杂些。

2. saltstack(拓展)

   基于python语言。相对简单，大并发能力比ansible要好, 需要维护被管理端的服务。如果服务断开,连接就会出问题。

3. ansible

   基于python语言。简单快捷，被管理端不需要启服务。直接走ssh协议,需要验证所以机器多的话速度会较慢。

















