```python
# coding=utf-8
# @Author:wyp
# @FileName:local_toos_helper.py
# @DateTime:2024/1/17 18:17
import os
from pathlib import Path
import shutil
import datetime
import hashlib
root_path = str(Path(__file__).resolve().parent)
today = datetime.datetime.today().strftime("%Y-%m-%d")
def record_message(message):
    current_time = datetime.datetime.now()
    formatted_time = current_time.strftime("%H:%M:%S")
    print(f"{formatted_time}--{message}")
def record_exception_message(message, exception=Exception):
    """Log an error message and throw an exception."""
    record_message(message)
    raise exception(message)
def get_local_file_md5(file_path):
    if not Path(file_path).is_file():
        raise TypeError(f"The {file_path} is not a file")
    cmd = f"md5sum {file_path}"
    return os.popen(cmd).read().split()[0]
def copy_file(source_path, target_path):
    """
    复制文件,目标文件存在则覆盖。
    """
    shutil.copy(source_path, target_path)
def copy_dir(source_path, target_path):
    """
    target_path必须是一个不存在的路径。
    如果target_path和source_path最后的目录名称不一样，相当于拷贝目录并更改了名称。
    """
    shutil.copytree(source_path, target_path)
def rename(source_path, new_name):
    """
    >> rename("/root/test.bash", "test.sh")
    >> /root/test.sh
    """
    new_path = Path(source_path).with_name(new_name)
    Path(source_path).rename(new_path)
    return str(new_path)
def mkdir(dir_path, parents=False, exist_ok=False):
    """Create a new directory at this given path.
    Param: parent=Ture,recursively create a directory.
    Param: exist_ok=True,allowed directory already exists.
    """
    Path(dir_path).mkdir(parents=parents, exist_ok=exist_ok)
def tar_zcf(target_path):
    """默认压缩格式为tar.gz.如果压缩文件已存在，则覆盖。"""
    _is_absolute_path(target_path)
    target_name = Path(target_path).name
    return shutil.make_archive(target_path, "gztar", Path(target_path).parent, target_name)
def tar_zxf(tar_path, target_path):
    _is_absolute_path(target_path, tar_path)
    shutil.unpack_archive(tar_path, Path(target_path).name)
def get_file_content(file_path):
    return Path(file_path).read_text(encoding="utf-8")
def get_text_content_md5(content):
    md5_hash = hashlib.md5(content.encode()).hexdigest()
    return md5_hash
def rm_dir(dir_path: str or Path):
    """删除目录，但是不能删除根目录以及根下的一级目录和二级目录。"""
    dir_path = str(Path(dir_path))
    _is_absolute_path(dir_path)
    if not Path(dir_path).exists():
        raise Exception(f"Can not found the directory '{dir_path}'.")
    if dir_path != "/" and dir_path.endswith("/"):
        dir_path = dir_path[0:-1]
    length = len(dir_path.split("/"))
    if length in [2, 3]:
        raise Exception(f"Can not delete the directory '{dir_path}'.")
    shutil.rmtree(dir_path)
def is_salt_file_exist(salt_path, salt_base):
    salt_path = convert_salt_base(salt_path, salt_base)
    return Path(salt_path).exists()
def _is_absolute_path(*args):
    for path in args:
        if not Path(path).is_absolute():
            raise ValueError(f"{path} must be a absolute path.")
def convert_salt_base(salt_path, salt_base_dir):
    """Convert the salt path to an absolute path.
    Example: salt://infra/test   -->  /srv/salt/infra/test
    """
    if not salt_path.startswith(r"salt://"):
        record_exception_message(f"Slat path must start with 'salt://', error path: [{salt_path}]")
    source_path = salt_path.strip()[7:]
    return str(Path(salt_base_dir).joinpath(source_path))
```