# 1、查看当前登录用户，以及人数

- 首先，你需要在 Django 的 settings.py 文件中配置 Session 后端，例如：

```python
 SESSION_ENGINE = 'django.contrib.sessions.backends.db'        
  #这个配置会将 Session 数据存储在数据库中。
```

- 你的视图函数或者模板中，可以通过以下代码获取当前已登录用户的数量：

```python
from django.contrib.sessions.models import Session
from django.contrib.auth.models import User
import datetime
#通过查询 Session 数据库表获取当前所有的 Session 记录：
#过滤出 expire_date 大于等于当前时间的记录。
sessions = Session.objects.filter(expire_date__gte=datetime.datetime.now())   
users=[]
for session in sessions:
    data=session.get_decoded()
    user_id=data.get("_auth_user_id")
    if user_id:
        user=User.objects.get(pk=user_id)
        if user not in users:
            users.append(user)
num_users=len(users)
print("当前登录用户：",users)
print("当前登录人数：",num_users)
#这里 get_decoded() 方法用于解码 Session 数据，返回一个字典对象，包含了 Session 中存储的信息。
#其中 _auth_user_id 对应的就是当前登录用户的 ID。通过这个 ID，我们可以在数据库中查询到对应的用户信息。
#注意，这种方式只能获取当前已登录系统的用户信息，无法统计历史登录用户或在线时长等信息。
#如果需要进一步扩展，你可以考虑使用 Django 的中间件来实现。
```