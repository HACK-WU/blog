**点赞点踩组件**

# test.html

```
<style>
/* ******************************点赞点踩样式****************************************** */
    #div_digg {
        float: right;
        margin-bottom: 10px;
        margin-right: 30px;
        font-size: 12px;
        width: 128px;
        text-align: center;
        margin-top: 10px;
    }
    .diggit {
        float: left;
        width: 46px;
        height: 52px;
        background: url(/static/img/upup.gif) no-repeat;
        text-align: center;
        cursor: pointer;
        margin-top: 2px;
        padding-top: 5px;
    }
    .buryit {
        float: right;
        margin-left: 20px;
        width: 46px;
        height: 52px;
        background: url(/static/img/downdown.gif) no-repeat;
        text-align: center;
        cursor: pointer;
        margin-top: 2px;
        padding-top: 5px;
    }
    .diggword {
        margin-top: 5px;
        margin-left: 0;
        font-size: 12px;
        color: #808080;
    }
</style>
/* ******************************点赞点踩样主体标签****************************************** */
<div class="clearfix">
    <div id="div_digg">
        <div class="diggit action" >
            <span class="diggnum" id="digg_count">{{ article_obj.up_num }}</span>
        </div>
        <div class="buryit action">
            <span class="burynum" id="bury_count">{{ article_obj.down_num }}</span>
        </div>
        <div class="clear"></div>
        <div class="diggword" id="digg_tips" style="color: red">
        </div>
    </div>
</div>
/*
 ********************************************** 点 赞 点 踩jQuery*********************************************
 */
    //给所有的action绑定事件
    $(".action").click(function () {
        let isUp=$(this).hasClass("diggit");  //判断该标签class属性是否含有"diggit"这个值
        let $div=$(this);
        //朝后端发送ajax请求
        $.ajax({
            url:"/up_or_down/",
            type:"post",
            data:{
                "article_id":"{{ article_obj.pk }}",
                "isUp":isUp,
                "csrfmiddlewaretoken":"{{ csrf_token }}"
            },
            success:function (args) {
                if(args.code==1000){
                    $("#digg_tips").text(args.msg);
                    //将前端的数
                    //先获取到之前的数字
                    let oldNum=$div.children().text();  //文本 字符类型
                    $div.children().text(Number(oldNum)+1);
                }else{
                    $("#digg_tips").html(args.msg);
                }
            }
        })
    });
```

## vews.py

```
from django.shortcuts import render,HttpResponse,redirect
from app01.myforms import MyRegForm
from app01 import models
from django.http import JsonResponse
from django.contrib import  auth
from django.contrib.auth.decorators import login_required
import json
from django.db.models import F,Q
from app01.myModel import  myCaptcha
#点赞点踩
def up_or_down(request):
    '''
        1、校验当前用户是否登录
        2、判断当前文章是否是当前用户自己写的（用户不可以给自己文章点赞点踩）
        3、判断当前用户是否已经给当前文章点过了。只能点一次。
        4、操纵数据库
    '''
    if request.method=="POST":
        back_dic={
            "code":1000,
            "msg":"",
        }
        #1、判断当前用户是否登录
        if request.user.is_authenticated:     #用户已经登录
            article_id=request.POST.get("article_id") #文章主键值
            isUp=request.POST.get("isUp")   #返回值是一个字符串，值是"true"或者"false"
            isUp=json.loads(isUp)           #将普通字符串，转换为python格式的数据类型，相当于去掉双引号操作
            #2、判断当前文章是否是当前用户自己写的。
            article_obj=models.Article.objects.get(pk=article_id)
            if not article_obj.blog.userinfo==request.user:
                #3、校验当前用户是否已经点了
                is_click=models.UpAndDown.objects.filter(user=request.user,article=article_obj)
                if not is_click:
                   #4、操作数据库，纪录数据 要同步操作普通字段
                   # 判断当前用户是点了赞还是踩 从而决定给哪个字段加一
                    if isUp:
                        #给点赞数加一
                        models.Article.objects.filter(pk=article_id).update(up_num=F("up_num")+1)
                        back_dic["msg"]="点赞成功"
                    else:
                        #给点踩数加一
                       models.Article.objects.filter(pk=article_id).update(down_num=F("down_num")+1)
                       back_dic["msg"]="点踩成功"
                    # 操作点赞点踩表
                    models.UpAndDown.objects.create(user=request.user,article=article_obj,is_up=isUp)
                else:
                    back_dic["code"]=2000
                    back_dic["msg"]="你已经点过了，不能在点了"
            else:
                back_dic["code"]=3000
                back_dic["msg"]="不能给自己点赞"
        else:
            back_dic["code"]=4000
            back_dic["msg"]="<p><a href='/login/'>请先登录</a></p>"
        print("*********执行完毕*************")
        return JsonResponse(back_dic)
```